
    You are an expert full-stack developer proficient in TypeScript, React, Next.js, and modern UI/UX frameworks (e.g., Tailwind CSS, Shadcn UI, Radix UI). Your task is to produce the most optimized and maintainable Next.js code, following best practices and adhering to the principles of clean code and robust architecture.

    ---

    ## Objective
    - Create a Next.js solution that is not only functional but also adheres to the best practices in performance, security, and maintainability.

    ---

    ## Coding Standards & Style

    ### Naming Conventions
    - Use descriptive names with auxiliary verbs (e.g., `isLoading`, `hasError`).

    ### Exports
    - Use **Named Exports** (`export function MyComponent`) ONLY.
    - Avoid default exports to ensure consistency and improve tree-shaking.

    ### Type Safety
    - **STRICTLY NO `any`**. Use `unknown` with type guards if necessary.
    - Define clear interfaces for all data structures.
    ```typescript
    // ❌ FORBIDDEN
    function handleData(data: any) { return data.id }

    // ✅ CORRECT
    function handleData(data: User) { return data.id }
    function processUnknown(data: unknown) {
      if (isUser(data)) return data.id
    }
    ```

    ### Imports
    - Prefer absolute imports (e.g., `@/components/common/Header`).

    ### Environment Variables
    - NEVER use `process.env` directly. Use `lib/env.ts` (Zod validated).
    ```typescript
    // ❌ FORBIDDEN
    const key = process.env.API_KEY

    // ✅ CORRECT
    import { env } from '@/lib/env'
    const url = env.NEXT_PUBLIC_API_URL
    ```

    ### Functional Programming
    - Avoid classes (except ErrorBoundary); favor iteration and modularization.

    ---

    ## Architecture & Rendering (Hybrid SPA Mode)

    > **중요:** 이 프로젝트는 **하이브리드 SPA**입니다!
    > - UI/페이지: Client Components (`'use client'`)
    > - 인증(HttpOnly 쿠키): SSR 허용 (보안상 필수)

    ### Required
    - ✅ ALL UI components and pages MUST have `'use client'` directive at the top.
    - ✅ Data fetching via React Query on the client.
    - ✅ Backend API is a separate server (Spring Boot, etc.).
    - ✅ Build mode: `output: 'standalone'` (Node.js 서버 배포).

    ### SSR Exceptions (인증/보안 전용)
    - ✅ **API Routes** (`app/api/[...path]/route.ts`) - 백엔드 프록시 + 토큰 갱신용
    - ✅ **Server Actions** (`app/actions/auth-actions.ts`) - HttpOnly 쿠키 관리용
    - ✅ **Server-side cookies** (`next/headers`) - 인증 관련 함수에서만 사용

    ### Prohibited (UI/페이지에서)
    - ❌ **Server Components** for UI - 모든 UI는 `'use client'` 필수.
    - ❌ **Server-side data fetching** in pages - React Query 사용.
    - ❌ **`useEffect` for data fetching** - Use React Query instead.

    ```typescript
    // ❌ FORBIDDEN - Server Component
    async function UsersPage() {
      const users = await fetch('...') // Server에서 실행!
      return <div>{users}</div>
    }

    // ✅ CORRECT - Client Component with React Query
    'use client'

    import { useQuery } from '@tanstack/react-query'
    import { getUsers } from '@/lib/api/users'

    export default function UsersPage() {
      const { data: users, isLoading } = useQuery({
        queryKey: ['users'],
        queryFn: getUsers
      })

      if (isLoading) return <Loading />

      return (
        <div>
          {users?.map(user => <UserCard key={user.id} user={user} />)}
        </div>
      )
    }
    ```

    ---

    ## Data Fetching & Backend

    ### Axios
    - Use the pre-configured Axios instance (`lib/api/client.ts`) for ALL API requests.
    - Configure interceptors for auth tokens and error handling.

    ### React Query (TanStack Query)
    - Use for ALL server state management.
    - Configure `staleTime` and `gcTime` appropriately.
    ```typescript
    const queryClient = new QueryClient({
      defaultOptions: {
        queries: {
          staleTime: 5 * 60 * 1000,  // 5분
          gcTime: 10 * 60 * 1000,    // 10분
          retry: 1,
          refetchOnWindowFocus: false,
        },
      },
    })
    ```

    ### State Management
    - **Zustand** for global client state (auth, UI).
    - Use `persist` middleware for localStorage persistence.

    ### Forms
    - Use **React Hook Form + Zod** for all forms.

    ---

    ## Error Handling

    - Use early returns for error conditions.
    - Implement guard clauses for preconditions.
    - Use custom error types for consistent handling.
    - Wrap app with ErrorBoundary component.

    ---

    ## UI and Styling

    - Use **Tailwind CSS** for styling.
    - Use **shadcn/ui** components (DO NOT MODIFY in `components/ui/`).
    - Implement responsive design patterns.
    - Use `cn()` utility for conditional class names.

    ---

    ## Testing

    - Use **Playwright** for End-to-End (E2E) and component testing.
    - Provide clear and concise comments for complex logic.
    - Use JSDoc comments for functions and components.

    ---

    ## Package Management

    - **Always use `pnpm`** for package management.
    - Do NOT use `npm` or `yarn` unless explicitly required.

    ---

    ## Project Directory Structure

    ```
    app/
    ├── (auth)/              # Authentication route groups
    │   ├── login/page.tsx
    │   └── register/page.tsx
    ├── (main)/              # Main app route groups (protected)
    │   ├── layout.tsx       # Layout with Header, Sidebar
    │   ├── dashboard/page.tsx
    │   └── users/
    │       ├── page.tsx
    │       └── [id]/page.tsx
    ├── layout.tsx           # Root layout (Providers)
    └── page.tsx

    components/
    ├── ui/                  # shadcn/ui (DO NOT MODIFY)
    ├── common/              # Header, Sidebar, Loading, ErrorBoundary
    ├── forms/               # React Hook Form + Zod
    └── features/            # Feature-specific (users/, products/)

    lib/
    ├── api/                 # Axios client + API functions
    ├── hooks/               # React Query wrapper hooks
    ├── store/               # Zustand stores (authStore, uiStore)
    ├── validations/         # Zod schemas
    └── utils/               # cn, format, storage

    types/                   # TypeScript type definitions
    public/                  # Static assets
    tests/ & playwright/     # Testing configurations
    ```

    ---

    ## Methodology

    1. **System 2 Thinking**: Approach problems analytically. Break down requirements into smaller parts.
    2. **Tree of Thoughts**: Evaluate multiple solutions before selecting the optimal one.
    3. **Iterative Refinement**: Consider improvements, edge cases, and optimizations before finalizing.

    ### Process
    1. **Deep Dive Analysis**: Analyze technical requirements and constraints.
    2. **Planning**: Develop clear architectural structure and flow.
    3. **Implementation**: Follow best practices step-by-step.
    4. **Review and Optimize**: Look for optimization opportunities.
    5. **Finalization**: Ensure security, performance, and completeness.

    ---

    ## Plan Mode 사용법

    ### 모든 중요한 작업은 Plan Mode로 시작

    1. **시작**: "먼저 계획을 세워줘" 또는 "implementation plan 작성해줘"
       <!-- Cursor 전용: Shift+Tab 2번으로 Plan Mode 진입 가능 -->
    2. **검토**: Claude의 계획을 꼼꼼히 확인
    3. **피드백**: 빠진 부분, 수정 필요한 부분 지적
    4. **반복**: 완벽한 계획이 될 때까지 2-3번 반복
    5. **실행**: "이대로 실행해줘" - auto-accept edits 모드

    ### 좋은 계획의 조건

    - [ ] 모든 파일이 명시되어 있는가?
    - [ ] 구현 순서가 논리적인가?
    - [ ] 엣지 케이스를 고려했는가?
    - [ ] 사용할 기술이 명확한가?
    - [ ] 테스트 방법이 포함되어 있는가?

    ### 예시

    ```
    ❌ 나쁜 요청: "로그인 만들어줘"
    ✅ 좋은 요청: "먼저 로그인 기능 구현 계획을 세워줘. 
                   JWT 사용, 이메일 중복 체크, 
                   비밀번호 해싱 포함해야 해"
    ```

    ---

    ## Quick Reference

    | Category | Rule |
    |----------|------|
    | Components | Always `'use client'` |
    | Types | No `any`, use interfaces |
    | Fetching | React Query only |
    | State | Zustand for global |
    | Forms | React Hook Form + Zod |
    | Styling | Tailwind + shadcn/ui |
    | Testing | Playwright |
    | Package | pnpm only |
